using System;
using System.Threading.Tasks;
using VirusTotalNet;
using VirusTotalNet.ResponseCodes;
using VirusTotalNet.Results;


namespace AnaliseMalware.Services
{
    public class VirusTotalApiClient
    {
        private readonly VirusTotal _virusTotalClient;

        // Constructor
        public VirusTotalApiClient(string apiKey)
        {
            _virusTotalClient = new VirusTotal(apiKey);
        }

        // Scan File Method
        public async Task<ScanResult> ScanFileAsync(string filePath)
        {
            try
            {
                var scanResult = await _virusTotalClient.ScanFileAsync(filePath);
                return scanResult;
            }
            catch (Exception ex)
            {
                throw new Exception("Error scanning file", ex);
            }
        }

        // File Report Method
        public async Task<FileReport> GetFileReportAsync(string fileHash)
        {
            try
            {
                var fileReport = await _virusTotalClient.GetFileReportAsync(fileHash);
                return fileReport;
            }
            catch (Exception ex)
            {
                throw new Exception("Error retrieving file report", ex);
            }
        }

        // URL Report Method
        public async Task<UrlReport> GetUrlReportAsync(string url)
        {
            try
            {
                var urlReport = await _virusTotalClient.GetUrlReportAsync(url);
                return urlReport;
            }
            catch (Exception ex)
            {
                throw new Exception("Error retrieving URL report", ex);
            }
        }
    }
}
