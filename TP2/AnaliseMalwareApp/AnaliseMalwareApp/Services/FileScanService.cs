using System.Net.Http;
using System.Text;
using System.Text.Json;
using System.Threading.Tasks;

namespace AnaliseMalwareApp.Services
{
    public class FileScanService
    {
        private readonly HttpClient _httpClient;

        public FileScanService(HttpClient httpClient)
        {
            _httpClient = httpClient;
        }

        // Call the Scan File API
        public async Task<string> ScanFileAsync(byte[] fileBytes)
        {
            using var content = new MultipartFormDataContent();
            content.Add(new ByteArrayContent(fileBytes), "file", "uploadedFile");

            var response = await _httpClient.PostAsync("api/File/scan", content);
            response.EnsureSuccessStatusCode();

            return await response.Content.ReadAsStringAsync();
        }

        // Call the Report API
        public async Task<string> GetReportAsync(string analysisId)
        {
            var response = await _httpClient.GetAsync($"api/File/report/{analysisId}");
            response.EnsureSuccessStatusCode();

            return await response.Content.ReadAsStringAsync();
        }

        // Call the Scan by Hash API
        public async Task<string> ScanByHashAsync(string fileHash)
        {
            var response = await _httpClient.GetAsync($"api/File/scanHash/{fileHash}");
            response.EnsureSuccessStatusCode();

            return await response.Content.ReadAsStringAsync();
        }
    }
}
